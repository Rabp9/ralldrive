<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core">
  
    <body>

        <ui:composition template="./../Plantillas/template.xhtml">

            <ui:define name="title">
                ${loginBean.usuario} - RallDrive
            </ui:define>

            <ui:define name="left">
                <h:form id="nodos">
                    <p:outputLabel id="lblUsuario" value="Usuario: "/>
                    <h:outputText id="usuario" value="${loginBean.usuario}"/>
                    <p:tree id="arbolCarpetas" value="${loginBean.root}"  
                        var="carpeta" selectionMode="single"
                        selection="${loginBean.selectedNode}">
                        <p:ajax event="select" listener="${loginBean.onNodeSelect}"
                            update="_formHome_carpetaPanel"/>

                        <p:treeNode expandedIcon="ui-icon-folder-open"
                            collapsedIcon="ui-icon-folder-collapsed">
                            <h:outputText value="${carpeta.nombre}"/>
                        </p:treeNode>

                        <p:treeNode type="image" icon="ui-icon-folder">
                            <h:outputText value="${carpeta.nombre}"/>
                        </p:treeNode>
                    </p:tree>
                </h:form>
            </ui:define>

            <ui:define name="content">
                <h:form id="formHome" enctype="multipart/form-data">
                    <p:panel id="carpetaPanel" header="${loginBean.selectedNode.data.nombre}">
                        <h:messages layout="table" />
                        <p:fileUpload id="fileUpload" fileUploadListener="${loginBean.upload}" multiple="true"
                           sizeLimit="10000000" invalidFileMessage="fichero inv치lido" invalidSizeMessage="ha excedido el tama침o m치ximo permitido"
                           label="Seleccionar archivo" cancelLabel="Cancelar" uploadLabel="Subir" update="_formHome_carpetaPanel">
                        </p:fileUpload>
                        
                        <p:dialog widgetVar="crearCarpetaDialog" modal="true" header="Nombre de Carpeta">
                            <p:inputText id="carpetaNueva" value="${loginBean.nuevaCarpeta}"/>
                            <p:commandButton id="btnCrearCarpeta" update="_nodos_arbolCarpetas, _formHome_carpetaPanel" value="Crear" action="${loginBean.crearCarpeta}"/>
                        </p:dialog>
                        <p:commandButton value="Crear Carpeta" onclick="crearCarpetaDialog.show()" />
                        
                        <p:commandButton id="btnSubirCarpeta" action="${loginBean.subirCarpeta}" update="_nodos_arbolCarpetas, _formHome_carpetaPanel" icon="ui-icon-arrowreturnthick-1-n" />
                    
                        <p:dialog widgetVar="opcionesDialog" modal="true" header="Elegir una acci칩n" width="280px" height="150px">
                            <p:menu id="mnOpciones">
                                <p:menuitem icon="ui-icon-disk" value="Descargar" ajax="false" actionListener="${loginBean.download(loginBean.selectedRow)}">
                                    <p:fileDownload value="${loginBean.file}" />
                                </p:menuitem>
                                <p:menuitem icon="ui-icon-search" value="Mostrar" outcome="${loginBean.mostrar(loginBean.selectedRow)}" target="_blank"/>
                                <p:menuitem icon="ui-icon-close" value="Eliminar" url="http://prototypejs.org"/>
                            </p:menu>
                        </p:dialog>
                        
                         <p:dataTable id="tablaRecursos" value="${loginBean.recursos}" 
                            var="recurso" selectionMode="single" rowKey="${recurso.id}"
                            selection="${loginBean.selectedRow}" scrollable="true"
                            scrollHeight="400" emptyMessage="Carpeta Vacia">
                             
                            <p:ajax event="rowSelect" listener="${loginBean.onRowSelect}"
                                update="_formHome_carpetaPanel" />
                            
                            <p:column headerText="Nombre" filterBy="${recurso.nombre}">  
                                <h:outputText value="${recurso.nombre}" />
                            </p:column>
                            
                            <p:column headerText="Fecha" filterBy="${recurso.fecha}">
                                <h:outputText value="${recurso.fecha}">
                                    <f:convertDateTime pattern="dd/MM/yyyy"/>
                                </h:outputText>
                            </p:column>
                            
                            <f:facet name="footer">  
                                <p:commandButton icon="ui-icon-search" oncomplete="opcionesDialog.show()"/>
                            </f:facet>  
                         </p:dataTable>
                    </p:panel>
                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
