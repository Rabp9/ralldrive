<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:c="http://java.sun.com/jsp/jstl/core"
      xmlns:f="http://java.sun.com/jsf/core">
  
    <body>

        <ui:composition template="./../Plantillas/template.xhtml">

            <ui:define name="title">
                ${loginBean.usuario} - RallDrive
            </ui:define>

            <ui:define name="left">
                <h:form id="nodos">
                    <p:outputLabel id="lblUsuario" value="Usuario: "/>
                    <h:outputText id="usuario" value="${loginBean.usuario}"/>
                    <p:tree id="arbolCarpetas" value="${loginBean.root}"  
                        var="carpeta" selectionMode="single"
                        selection="${loginBean.selectedNode}">
                        <p:ajax event="select" listener="${loginBean.onNodeSelect}"
                            update="_formHome_carpetaPanel"/>

                        <p:treeNode expandedIcon="ui-icon-folder-open"
                            collapsedIcon="ui-icon-folder-collapsed">
                            <h:outputText value="${carpeta.nombre}"/>
                        </p:treeNode>

                        <p:treeNode type="image" icon="ui-icon-folder">
                            <h:outputText value="${carpeta.nombre}"/>
                        </p:treeNode>
                    </p:tree>
                </h:form>
            </ui:define>

            <ui:define name="content">
                <h:form id="formHome" enctype="multipart/form-data">
                    <p:panel id="carpetaPanel" header="${loginBean.selectedNode.data.nombre}">
                        <h:messages layout="table" />
                        <p:fileUpload id="fileUpload" fileUploadListener="${loginBean.upload}" multiple="true"
                           sizeLimit="10000000" invalidFileMessage="fichero inválido" invalidSizeMessage="ha excedido el tamaño máximo permitido"
                           label="Seleccionar archivo" cancelLabel="Cancelar" uploadLabel="Subir" update="_formHome_carpetaPanel">
                        </p:fileUpload>
                        
                        <p:dialog widgetVar="crearCarpetaDialog" modal="true" header="Nombre de Carpeta">
                            <p:inputText id="carpetaNueva" value="${loginBean.nuevaCarpeta}"/>
                            <p:commandButton id="btnCrearCarpeta" update="_nodos_arbolCarpetas, _formHome_carpetaPanel" value="Crear" action="${loginBean.crearCarpeta}"/>
                        </p:dialog>
                        <p:commandButton value="Crear Carpeta" onclick="crearCarpetaDialog.show()" />
                        
                    </p:panel>
                </h:form>
            </ui:define>
        </ui:composition>
    </body>
</html>
